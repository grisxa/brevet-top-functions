import numpy as np
import pytest
from numpy.typing import ArrayLike

from brevet_top_strava.build import get_track_start_point, build_track


@pytest.fixture
def activity_good() -> dict:
    return {
        "start_date": "2021-11-09T05:45:28Z",
        "start_latlng": [60.03, 30.3],
    }


@pytest.fixture
def activity_bad() -> dict:
    return {"start_date": "unknown", "start_latlng": [60.03, 30.3]}


@pytest.fixture
def strava_streams() -> dict:
    return {
        "latlng": {
            "data": [
                [60.025713, 30.29734],
                [60.025625, 30.297406],
                [60.025575, 30.297454],
                [60.02552, 30.297452],
                [60.025453, 30.297434],
                [60.025293, 30.297601],
                [60.025116, 30.29773],
                [60.024914, 30.297826],
                [60.024724, 30.297815],
                [60.02469, 30.297811],
                [60.024587, 30.297747],
                [60.024517, 30.297373],
                [60.024481, 30.297183],
                [60.024378, 30.296837],
                [60.024261, 30.296505],
                [60.024237, 30.296295],
                [60.024187, 30.295933],
                [60.024146, 30.295574],
                [60.024162, 30.295296],
                [60.024175, 30.294893],
                [60.024127, 30.294478],
                [60.024091, 30.294149],
                [60.024054, 30.293793],
                [60.024016, 30.293425],
                [60.02399, 30.293133],
                [60.023948, 30.29275],
                [60.023922, 30.292348],
                [60.023891, 30.29196],
                [60.023869, 30.291812],
                [60.023795, 30.291481],
                [60.023681, 30.29139],
                [60.023683, 30.291422],
                [60.023675, 30.291428],
                [60.023635, 30.291479],
                [60.023572, 30.291526],
                [60.023373, 30.291625],
                [60.02331, 30.291608],
                [60.023283, 30.29158],
                [60.023267, 30.291567],
                [60.023266, 30.291566],
                [60.023265, 30.291567],
                [60.023265, 30.291566],
                [60.023266, 30.291568],
                [60.023267, 30.291558],
                [60.023221, 30.291204],
                [60.023166, 30.290908],
                [60.023065, 30.290579],
                [60.022983, 30.290312],
                [60.022919, 30.289975],
                [60.022874, 30.289771],
                [60.02285, 30.289635],
                [60.022802, 30.289238],
                [60.022735, 30.288894],
                [60.022664, 30.288498],
                [60.022591, 30.288128],
                [60.022582, 30.287997],
                [60.02254, 30.287584],
                [60.022528, 30.287521],
                [60.022506, 30.287251],
                [60.022499, 30.287023],
                [60.022476, 30.286748],
                [60.022469, 30.286679],
                [60.022443, 30.286323],
                [60.022427, 30.285954],
                [60.022438, 30.285541],
                [60.022456, 30.285161],
                [60.02248, 30.284956],
                [60.022511, 30.284542],
                [60.022549, 30.284144],
                [60.022599, 30.283744],
                [60.022625, 30.28333],
                [60.022647, 30.283125],
                [60.022705, 30.282741],
                [60.022773, 30.282509],
                [60.022809, 30.282348],
                [60.022818, 30.282297],
                [60.022823, 30.282254],
                [60.022822, 30.2822],
                [60.022728, 30.282004],
                [60.022597, 30.28194],
                [60.022382, 30.281864],
                [60.022175, 30.281769],
                [60.02211, 30.281739],
                [60.02192, 30.281685],
                [60.02172, 30.281609],
                [60.021515, 30.281496],
                [60.02131, 30.281386],
                [60.021124, 30.281276],
                [60.020928, 30.281149],
                [60.020861, 30.281111],
                [60.020676, 30.281043],
                [60.020497, 30.280963],
                [60.020366, 30.280903],
                [60.02019, 30.280809],
                [60.020016, 30.280712],
                [60.019811, 30.280653],
                [60.019773, 30.280642],
                [60.019593, 30.280563],
                [60.019464, 30.28048],
                [60.019288, 30.280346],
                [60.01919, 30.280277],
                [60.019012, 30.280162],
                [60.018806, 30.280067],
                [60.018771, 30.28005],
                [60.018587, 30.279962],
                [60.018551, 30.279944],
                [60.018404, 30.279859],
                [60.018365, 30.279835],
                [60.01817, 30.279712],
                [60.017999, 30.27958],
                [60.017902, 30.27951],
                [60.017719, 30.2794],
                [60.01754, 30.279295],
                [60.017451, 30.279251],
                [60.017446, 30.279238],
                [60.017435, 30.279209],
                [60.017428, 30.279206],
                [60.017462, 30.27899],
                [60.017514, 30.278604],
                [60.017572, 30.278198],
                [60.017589, 30.278067],
                [60.017661, 30.277676],
                [60.017735, 30.277302],
                [60.017767, 30.277101],
                [60.017791, 30.276747],
                [60.017793, 30.276677],
                [60.017793, 30.276602],
                [60.017798, 30.27653],
                [60.017818, 30.276198],
                [60.017853, 30.275809],
                [60.017999, 30.275459],
                [60.018025, 30.275212],
                [60.018047, 30.274817],
                [60.0181, 30.274432],
                [60.018176, 30.274032],
                [60.018204, 30.273653],
                [60.018228, 30.273349],
                [60.018299, 30.272969],
                [60.018347, 30.272705],
                [60.018382, 30.272296],
                [60.018403, 30.271892],
                [60.018403, 30.271496],
                [60.018409, 30.271434],
                [60.018415, 30.271367],
                [60.018449, 30.271093],
                [60.018445, 30.271049],
                [60.018403, 30.271033],
                [60.018361, 30.271015],
                [60.018172, 30.270947],
                [60.017976, 30.270907],
                [60.017776, 30.270897],
                [60.017569, 30.270809],
                [60.017357, 30.270698],
                [60.017321, 30.27068],
                [60.017285, 30.270662],
                [60.017109, 30.270582],
                [60.017039, 30.27055],
                [60.016863, 30.270442],
                [60.016671, 30.270385],
                [60.016552, 30.270286],
                [60.01657, 30.269933],
                [60.016632, 30.269561],
                [60.016686, 30.269202],
                [60.016745, 30.268815],
                [60.016858, 30.268664],
                [60.016888, 30.268635],
                [60.01703, 30.268346],
                [60.017138, 30.268008],
                [60.017168, 30.267701],
                [60.017159, 30.267283],
                [60.017101, 30.266922],
                [60.01702, 30.266562],
                [60.016944, 30.266193],
                [60.016874, 30.265837],
                [60.016803, 30.26547],
                [60.016731, 30.265103],
                [60.016664, 30.264739],
                [60.016599, 30.264371],
                [60.016546, 30.264138],
                [60.016517, 30.26377],
                [60.016552, 30.263592],
                [60.016503, 30.263795],
                [60.016509, 30.263819],
                [60.01651, 30.263848],
                [60.016546, 30.264096],
                [60.016555, 30.264156],
                [60.016625, 30.26451],
                [60.016645, 30.264635],
                [60.016655, 30.26469],
                [60.016736, 30.265071],
                [60.016829, 30.265471],
                [60.016849, 30.265548],
                [60.016872, 30.265627],
                [60.016889, 30.265705],
                [60.016958, 30.266041],
                [60.01697, 30.266121],
                [60.016997, 30.266274],
                [60.017015, 30.266352],
                [60.017103, 30.266755],
                [60.017161, 30.267152],
                [60.0172, 30.267565],
                [60.017201, 30.267995],
                [60.017202, 30.268086],
                [60.017195, 30.268248],
                [60.017106, 30.268624],
                [60.017084, 30.268692],
                [60.01706, 30.268761],
                [60.017031, 30.268824],
                [60.017001, 30.268879],
                [60.016921, 30.268949],
                [60.016794, 30.268945],
                [60.016604, 30.268837],
                [60.01643, 30.268734],
                [60.016308, 30.268658],
                [60.016156, 30.268574],
                [60.015995, 30.26845],
                [60.015935, 30.268362],
                [60.015887, 30.268239],
                [60.015854, 30.268087],
                [60.015843, 30.267996],
                [60.015837, 30.267909],
                [60.015826, 30.267829],
                [60.015772, 30.2676],
                [60.015714, 30.267368],
                [60.015678, 30.267219],
                [60.015661, 30.26706],
                [60.015642, 30.266819],
                [60.015638, 30.266746],
                [60.015614, 30.266374],
                [60.015601, 30.266237],
                [60.015592, 30.266161],
                [60.015547, 30.265767],
                [60.015498, 30.265391],
                [60.015456, 30.265023],
                [60.015432, 30.264777],
                [60.015408, 30.264396],
                [60.015401, 30.264161],
                [60.015378, 30.263801],
                [60.015352, 30.26338],
                [60.015323, 30.263],
                [60.01532, 30.262651],
                [60.015315, 30.262266],
                [60.015378, 30.261904],
                [60.015488, 30.261548],
                [60.015666, 30.261286],
                [60.015835, 30.261021],
                [60.015993, 30.260755],
                [60.016155, 30.260527],
                [60.016333, 30.260334],
                [60.016511, 30.260175],
                [60.016637, 30.260033],
                [60.01667, 30.259998],
                [60.016838, 30.259794],
                [60.016872, 30.259757],
                [60.016903, 30.259718],
                [60.01706, 30.259537],
                [60.017133, 30.259502],
                [60.017216, 30.259505],
                [60.017351, 30.259786],
                [60.017295, 30.260143],
                [60.017164, 30.260455],
                [60.017096, 30.260815],
                [60.017074, 30.261176],
                [60.017056, 30.261539],
                [60.016931, 30.261821],
                [60.016858, 30.261881],
                [60.016694, 30.262063],
                [60.016552, 30.26234],
                [60.016448, 30.262659],
                [60.016434, 30.263052],
                [60.01644, 30.263436],
                [60.016502, 30.263776],
                [60.016579, 30.264155],
                [60.016651, 30.264494],
                [60.016727, 30.264842],
                [60.016789, 30.26518],
                [60.016828, 30.265394],
                [60.016892, 30.265783],
                [60.016959, 30.266166],
                [60.016971, 30.266235],
                [60.017022, 30.266449],
                [60.017093, 30.266796],
                [60.017177, 30.267159],
                [60.017244, 30.267528],
                [60.01726, 30.267897],
                [60.017236, 30.268203],
                [60.017166, 30.268563],
                [60.017035, 30.268885],
                [60.016833, 30.268991],
                [60.016743, 30.268956],
                [60.016543, 30.26886],
                [60.016463, 30.268803],
                [60.016256, 30.268685],
                [60.01607, 30.268511],
                [60.015922, 30.268335],
                [60.015861, 30.268225],
                [60.015732, 30.267891],
                [60.015625, 30.267589],
                [60.015605, 30.267525],
                [60.015575, 30.267388],
                [60.015524, 30.267029],
                [60.015498, 30.266643],
                [60.015475, 30.266253],
                [60.015442, 30.265877],
                [60.015418, 30.265503],
                [60.01541, 30.265293],
                [60.015386, 30.264913],
                [60.015339, 30.264531],
                [60.015299, 30.264146],
                [60.015287, 30.263732],
                [60.015283, 30.263335],
                [60.015274, 30.262918],
                [60.01527, 30.262546],
                [60.015255, 30.262153],
                [60.015251, 30.261777],
                [60.015313, 30.261401],
                [60.015473, 30.261141],
                [60.015665, 30.260963],
                [60.015842, 30.260764],
                [60.016027, 30.260578],
                [60.016218, 30.260435],
                [60.016389, 30.260232],
                [60.016451, 30.260154],
                [60.016606, 30.259965],
                [60.016771, 30.259795],
                [60.016955, 30.25959],
                [60.017149, 30.259564],
                [60.017248, 30.259688],
                [60.017272, 30.259837],
                [60.017266, 30.259977],
                [60.017236, 30.260088],
                [60.017101, 30.260365],
                [60.017035, 30.260702],
                [60.017033, 30.261081],
                [60.017066, 30.261437],
                [60.016971, 30.261754],
                [60.016797, 30.261882],
                [60.016675, 30.262036],
                [60.016606, 30.26213],
                [60.016586, 30.262175],
                [60.016453, 30.262462],
                [60.016392, 30.262841],
                [60.016397, 30.26324],
                [60.016439, 30.263636],
                [60.016525, 30.264015],
                [60.016605, 30.264385],
                [60.016668, 30.264738],
                [60.016751, 30.265111],
                [60.016782, 30.265271],
                [60.016842, 30.265615],
                [60.016875, 30.265777],
                [60.016944, 30.266081],
                [60.017031, 30.266445],
                [60.017068, 30.266593],
                [60.017141, 30.266942],
                [60.017219, 30.267314],
                [60.01725, 30.267715],
                [60.017215, 30.268093],
                [60.017192, 30.268238],
                [60.01707, 30.268568],
                [60.016904, 30.268808],
                [60.016694, 30.268812],
                [60.016608, 30.268778],
                [60.016419, 30.26871],
                [60.016303, 30.268666],
                [60.016225, 30.268634],
                [60.016039, 30.268487],
                [60.01586, 30.268283],
                [60.015737, 30.267966],
                [60.01563, 30.267629],
                [60.015578, 30.267259],
                [60.015574, 30.267188],
                [60.015546, 30.266783],
                [60.015529, 30.266386],
                [60.015498, 30.266015],
                [60.015483, 30.265647],
                [60.01546, 30.265271],
                [60.015438, 30.264884],
                [60.015412, 30.264512],
                [60.015394, 30.264101],
                [60.015376, 30.263727],
                [60.015341, 30.263355],
                [60.015323, 30.262948],
                [60.015317, 30.262549],
                [60.015308, 30.262138],
                [60.015307, 30.261712],
                [60.015386, 30.261354],
                [60.015558, 30.261145],
                [60.015757, 30.260969],
                [60.015945, 30.260781],
                [60.016145, 30.260595],
                [60.016329, 30.260399],
                [60.016501, 30.260206],
                [60.016655, 30.260007],
                [60.016824, 30.259824],
                [60.016986, 30.259618],
                [60.017186, 30.259569],
                [60.017265, 30.259718],
                [60.017228, 30.260034],
                [60.017174, 30.260171],
                [60.01705, 30.260461],
                [60.017005, 30.260821],
                [60.017014, 30.260993],
                [60.017052, 30.26129],
                [60.01704, 30.261538],
                [60.016957, 30.261742],
                [60.016779, 30.261903],
                [60.016623, 30.262109],
                [60.016499, 30.262371],
                [60.016409, 30.262709],
                [60.016413, 30.262986],
                [60.016429, 30.263227],
                [60.01646, 30.263597],
                [60.016535, 30.263953],
                [60.016597, 30.264299],
                [60.016628, 30.264422],
                [60.01666, 30.264613],
                [60.016687, 30.264794],
                [60.016762, 30.265191],
                [60.0168, 30.265424],
                [60.016811, 30.2655],
                [60.016882, 30.265881],
                [60.016911, 30.266045],
                [60.016986, 30.26645],
                [60.017057, 30.266827],
                [60.017121, 30.267175],
                [60.017158, 30.2674],
                [60.017164, 30.267548],
                [60.017167, 30.267699],
                [60.017179, 30.267818],
                [60.017211, 30.267807],
                [60.017216, 30.267673],
                [60.017204, 30.267303],
                [60.017186, 30.266939],
                [60.017162, 30.266523],
                [60.017147, 30.266096],
                [60.017139, 30.265681],
                [60.017132, 30.265265],
                [60.017124, 30.264875],
                [60.017101, 30.264543],
                [60.017072, 30.264443],
                [60.017019, 30.2644],
                [60.016844, 30.264281],
                [60.016685, 30.264097],
                [60.016583, 30.264053],
                [60.016571, 30.264094],
                [60.01656, 30.264135],
                [60.016548, 30.264176],
                [60.016593, 30.264368],
                [60.016598, 30.264421],
                [60.016637, 30.264642],
                [60.016652, 30.264718],
                [60.01666, 30.264757],
                [60.016698, 30.264903],
                [60.016727, 30.265084],
                [60.016806, 30.265438],
                [60.016848, 30.265633],
                [60.016922, 30.266003],
                [60.016986, 30.266368],
                [60.016998, 30.266418],
                [60.01702, 30.266515],
                [60.017053, 30.26671],
                [60.017128, 30.267076],
                [60.017188, 30.267465],
                [60.017187, 30.267859],
                [60.017143, 30.268263],
                [60.017067, 30.268535],
                [60.016968, 30.268844],
                [60.016878, 30.269195],
                [60.01681, 30.269322],
                [60.016729, 30.269613],
                [60.016706, 30.269784],
                [60.01665, 30.270166],
                [60.016672, 30.270302],
                [60.016868, 30.270404],
                [60.017045, 30.270483],
                [60.017229, 30.270564],
                [60.017408, 30.270653],
                [60.017609, 30.270756],
                [60.017804, 30.270856],
                [60.017979, 30.270904],
                [60.017999, 30.27092],
                [60.017973, 30.271293],
                [60.017871, 30.271651],
                [60.017815, 30.271992],
                [60.017763, 30.272389],
                [60.017716, 30.272752],
                [60.017684, 30.273069],
                [60.01765, 30.27345],
                [60.017638, 30.273848],
                [60.017591, 30.274241],
                [60.017537, 30.274627],
                [60.017475, 30.274948],
                [60.017402, 30.275291],
                [60.017326, 30.275653],
                [60.017298, 30.275908],
                [60.017291, 30.275967],
                [60.017258, 30.27618],
                [60.017194, 30.276554],
                [60.017126, 30.276935],
                [60.017051, 30.277322],
                [60.016985, 30.277703],
                [60.016996, 30.27793],
                [60.017072, 30.277963],
                [60.017265, 30.278008],
                [60.017419, 30.278067],
                [60.017617, 30.278154],
                [60.017794, 30.278235],
                [60.017897, 30.278259],
                [60.018012, 30.278264],
                [60.018156, 30.278334],
                [60.018327, 30.278449],
                [60.01841, 30.27848],
                [60.018596, 30.278606],
                [60.018776, 30.278701],
                [60.018945, 30.278791],
                [60.018974, 30.278802],
                [60.019096, 30.278867],
                [60.019249, 30.27898],
                [60.019397, 30.279093],
                [60.019587, 30.279192],
                [60.019612, 30.279201],
                [60.019788, 30.279297],
                [60.019862, 30.279333],
                [60.020051, 30.2794],
                [60.02011, 30.27943],
                [60.020298, 30.279538],
                [60.020349, 30.279571],
                [60.020536, 30.279623],
                [60.020737, 30.279643],
                [60.020765, 30.279646],
                [60.020794, 30.279649],
                [60.02099, 30.279712],
                [60.021176, 30.279832],
                [60.021358, 30.279962],
                [60.021518, 30.280094],
                [60.02161, 30.280165],
                [60.021789, 30.280291],
                [60.021965, 30.280397],
                [60.022164, 30.280508],
                [60.022356, 30.280621],
                [60.022535, 30.280724],
                [60.02271, 30.280816],
                [60.022881, 30.280942],
                [60.023026, 30.281112],
                [60.023004, 30.281397],
                [60.022949, 30.281784],
                [60.022918, 30.282162],
                [60.022963, 30.282279],
                [60.022982, 30.282295],
                [60.022991, 30.282266],
                [60.022991, 30.282267],
                [60.022991, 30.282267],
                [60.022991, 30.282267],
                [60.022996, 30.282272],
                [60.023048, 30.282311],
                [60.023225, 30.282388],
                [60.023398, 30.282525],
                [60.023415, 30.282545],
                [60.023422, 30.282618],
                [60.023379, 30.282982],
                [60.023332, 30.283363],
                [60.023313, 30.283514],
                [60.02329, 30.283888],
                [60.023256, 30.284251],
                [60.02322, 30.284633],
                [60.023362, 30.284748],
                [60.02354, 30.284798],
                [60.023659, 30.284811],
                [60.023663, 30.28481],
                [60.023664, 30.284816],
                [60.023668, 30.284835],
                [60.023672, 30.284852],
                [60.023658, 30.284871],
                [60.02362, 30.2849],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023618, 30.284909],
                [60.023636, 30.284743],
                [60.02364, 30.284742],
                [60.023669, 30.284754],
                [60.023747, 30.284863],
                [60.023758, 30.284919],
                [60.023779, 30.28515],
                [60.023847, 30.285454],
                [60.023977, 30.285723],
                [60.024004, 30.285805],
                [60.024023, 30.285883],
                [60.024035, 30.285921],
                [60.024122, 30.286265],
                [60.024135, 30.286322],
                [60.024212, 30.286622],
                [60.024253, 30.286976],
                [60.024298, 30.287349],
                [60.02434, 30.28772],
                [60.024342, 30.287969],
                [60.024432, 30.28832],
                [60.024517, 30.288701],
                [60.024635, 30.288972],
                [60.024669, 30.289037],
                [60.024685, 30.28907],
                [60.024813, 30.289341],
                [60.024866, 30.289339],
                [60.025067, 30.289172],
                [60.025249, 30.289047],
                [60.025429, 30.289217],
                [60.025506, 30.289567],
                [60.025671, 30.289753],
                [60.025859, 30.289735],
                [60.026051, 30.289618],
                [60.02623, 30.289525],
                [60.02643, 30.289424],
                [60.026618, 30.289313],
                [60.026809, 30.289209],
                [60.026866, 30.289185],
                [60.027054, 30.289101],
                [60.027239, 30.289087],
                [60.027282, 30.289155],
                [60.027343, 30.289518],
                [60.027399, 30.289906],
                [60.027435, 30.290264],
                [60.027488, 30.290626],
                [60.027536, 30.291019],
                [60.027587, 30.291363],
                [60.027659, 30.291735],
                [60.02772, 30.292108],
                [60.027774, 30.292453],
            ],
            "series_type": "distance",
            "original_size": 638,
            "resolution": "high",
        },
        "distance": {
            "data": [
                200.7,
                210.9,
                216.7,
                222.9,
                230.6,
                250.6,
                271.6,
                295.1,
                316.3,
                320.1,
                332.4,
                354.9,
                366.2,
                388.7,
                411.6,
                423.7,
                444.6,
                465.1,
                481.2,
                504.4,
                528.1,
                547.0,
                567.2,
                588.2,
                604.8,
                626.7,
                649.3,
                671.2,
                679.8,
                700.0,
                714.6,
                715.2,
                715.9,
                721.1,
                728.7,
                751.5,
                758.4,
                761.1,
                761.8,
                761.9,
                761.9,
                762.0,
                762.1,
                762.7,
                783.2,
                800.8,
                822.2,
                839.5,
                859.7,
                872.0,
                880.1,
                903.0,
                923.6,
                947.1,
                969.1,
                976.5,
                1000.0,
                1003.7,
                1019.0,
                1031.7,
                1047.3,
                1051.2,
                1071.3,
                1092.0,
                1114.9,
                1136.2,
                1147.8,
                1171.2,
                1193.8,
                1216.9,
                1240.1,
                1251.8,
                1274.2,
                1288.7,
                1298.3,
                1301.3,
                1303.8,
                1306.8,
                1323.0,
                1338.0,
                1362.3,
                1386.0,
                1393.4,
                1414.8,
                1437.4,
                1461.1,
                1484.6,
                1506.2,
                1529.2,
                1536.9,
                1557.9,
                1578.3,
                1593.3,
                1613.5,
                1633.7,
                1656.8,
                1661.1,
                1681.8,
                1696.8,
                1717.6,
                1729.1,
                1750.1,
                1773.6,
                1777.6,
                1798.7,
                1802.8,
                1819.9,
                1824.3,
                1847.1,
                1867.6,
                1879.1,
                1900.4,
                1921.2,
                1931.3,
                1932.1,
                1934.0,
                1934.7,
                1947.3,
                1969.5,
                1993.1,
                2000.6,
                2023.8,
                2046.2,
                2058.1,
                2078.1,
                2082.0,
                2086.1,
                2090.3,
                2108.9,
                2131.0,
                2153.5,
                2167.5,
                2189.7,
                2211.9,
                2235.9,
                2257.3,
                2274.5,
                2297.0,
                2312.6,
                2335.6,
                2358.2,
                2380.3,
                2383.8,
                2387.6,
                2403.3,
                2405.8,
                2409.8,
                2414.6,
                2435.8,
                2457.9,
                2480.4,
                2504.0,
                2528.4,
                2532.5,
                2536.6,
                2556.8,
                2564.8,
                2585.3,
                2606.9,
                2621.8,
                2641.9,
                2663.7,
                2684.6,
                2707.2,
                2722.6,
                2726.3,
                2748.9,
                2771.3,
                2788.8,
                2812.1,
                2833.3,
                2855.4,
                2877.6,
                2899.0,
                2921.0,
                2943.0,
                2964.6,
                2986.4,
                3000.6,
                3021.8,
                3032.5,
                3033.5,
                3035.0,
                3036.6,
                3051.0,
                3054.5,
                3075.7,
                3083.0,
                3086.3,
                3109.3,
                3133.9,
                3138.8,
                3143.8,
                3148.6,
                3168.8,
                3173.5,
                3182.5,
                3187.3,
                3211.9,
                3234.9,
                3258.5,
                3282.5,
                3287.6,
                3296.6,
                3319.9,
                3324.5,
                3329.2,
                3333.8,
                3338.4,
                3348.2,
                3362.4,
                3384.2,
                3404.3,
                3418.6,
                3436.1,
                3455.3,
                3463.6,
                3472.4,
                3481.6,
                3486.8,
                3491.7,
                3496.3,
                3510.5,
                3524.9,
                3534.2,
                3543.2,
                3556.8,
                3560.9,
                3581.8,
                3589.6,
                3594.0,
                3616.5,
                3638.1,
                3659.2,
                3673.1,
                3694.4,
                3707.4,
                3727.6,
                3751.2,
                3772.7,
                3792.0,
                3813.4,
                3834.7,
                3858.1,
                3881.8,
                3905.5,
                3928.5,
                3950.7,
                3973.2,
                3994.9,
                4011.0,
                4015.2,
                4037.2,
                4041.4,
                4045.5,
                4065.8,
                4074.1,
                4083.4,
                4106.9,
                4127.9,
                4150.6,
                4172.0,
                4192.2,
                4212.6,
                4234.3,
                4243.2,
                4264.2,
                4286.3,
                4307.6,
                4329.9,
                4351.3,
                4371.5,
                4394.3,
                4414.9,
                4436.0,
                4456.0,
                4468.7,
                4491.4,
                4514.0,
                4518.1,
                4531.3,
                4552.3,
                4574.5,
                4596.5,
                4617.1,
                4634.4,
                4656.1,
                4679.4,
                4703.0,
                4713.2,
                4736.0,
                4745.4,
                4769.3,
                4792.1,
                4811.4,
                4820.5,
                4844.0,
                4864.6,
                4868.9,
                4877.2,
                4898.0,
                4919.7,
                4941.6,
                4962.8,
                4983.7,
                4995.3,
                5016.6,
                5038.4,
                5060.2,
                5083.0,
                5104.9,
                5128.0,
                5148.6,
                5170.5,
                5191.5,
                5213.5,
                5236.9,
                5260.4,
                5283.0,
                5305.9,
                5328.6,
                5350.8,
                5358.9,
                5379.1,
                5399.8,
                5423.5,
                5445.4,
                5458.7,
                5467.5,
                5475.4,
                5482.4,
                5503.9,
                5524.0,
                5545.1,
                5565.4,
                5586.8,
                5607.6,
                5623.7,
                5633.0,
                5636.4,
                5658.1,
                5680.8,
                5703.1,
                5725.9,
                5749.1,
                5771.6,
                5792.5,
                5815.3,
                5824.9,
                5845.1,
                5854.9,
                5873.5,
                5895.9,
                5905.1,
                5926.3,
                5948.7,
                5971.2,
                5992.3,
                6000.7,
                6023.4,
                6046.5,
                6070.2,
                6079.9,
                6101.3,
                6114.5,
                6123.3,
                6145.6,
                6168.6,
                6191.1,
                6213.5,
                6235.1,
                6239.0,
                6261.7,
                6283.9,
                6304.8,
                6325.4,
                6346.5,
                6368.2,
                6389.1,
                6412.1,
                6433.1,
                6454.2,
                6476.9,
                6499.0,
                6521.9,
                6545.7,
                6568.0,
                6590.4,
                6614.5,
                6638.0,
                6662.5,
                6685.7,
                6707.8,
                6728.2,
                6749.6,
                6771.0,
                6794.0,
                6806.5,
                6825.4,
                6835.0,
                6856.4,
                6877.1,
                6886.7,
                6903.9,
                6918.1,
                6932.8,
                6954.7,
                6975.8,
                6995.9,
                7017.6,
                7033.0,
                7046.6,
                7067.7,
                7089.1,
                7109.7,
                7117.3,
                7128.8,
                7139.2,
                7162.9,
                7176.6,
                7181.0,
                7203.6,
                7213.3,
                7237.4,
                7259.9,
                7280.5,
                7293.8,
                7302.1,
                7310.5,
                7317.3,
                7321.9,
                7329.5,
                7350.2,
                7370.6,
                7393.9,
                7417.8,
                7441.0,
                7464.2,
                7486.0,
                7504.7,
                7511.2,
                7517.7,
                7538.3,
                7558.8,
                7571.2,
                7572.3,
                7573.4,
                7574.6,
                7584.8,
                7588.4,
                7600.9,
                7605.3,
                7607.7,
                7616.7,
                7627.3,
                7648.9,
                7660.8,
                7683.0,
                7704.6,
                7707.6,
                7713.6,
                7725.1,
                7747.1,
                7769.9,
                7791.9,
                7815.0,
                7832.3,
                7852.8,
                7874.9,
                7885.2,
                7904.2,
                7914.1,
                7936.3,
                7944.6,
                7967.4,
                7987.6,
                8008.6,
                8029.2,
                8052.2,
                8074.7,
                8095.5,
                8097.8,
                8119.3,
                8142.3,
                8162.3,
                8185.2,
                8206.0,
                8224.1,
                8245.7,
                8267.9,
                8290.4,
                8312.6,
                8331.6,
                8352.5,
                8374.3,
                8388.9,
                8392.2,
                8404.7,
                8426.7,
                8449.1,
                8472.2,
                8494.6,
                8508.6,
                8517.3,
                8539.0,
                8556.5,
                8579.0,
                8599.3,
                8610.9,
                8623.5,
                8639.9,
                8660.0,
                8669.3,
                8691.3,
                8712.1,
                8731.8,
                8735.0,
                8749.0,
                8767.2,
                8784.8,
                8806.6,
                8809.5,
                8829.8,
                8838.3,
                8859.7,
                8866.5,
                8888.3,
                8894.1,
                8914.8,
                8936.3,
                8939.4,
                8942.6,
                8964.5,
                8986.2,
                9007.4,
                9026.6,
                9037.5,
                9058.5,
                9079.0,
                9102.0,
                9124.3,
                9145.0,
                9165.3,
                9185.5,
                9205.9,
                9222.0,
                9244.3,
                9265.9,
                9274.3,
                9276.7,
                9278.0,
                9278.1,
                9278.1,
                9278.1,
                9278.8,
                9285.0,
                9305.1,
                9326.0,
                9328.1,
                9332.4,
                9353.3,
                9375.1,
                9383.8,
                9404.6,
                9425.0,
                9447.1,
                9465.1,
                9485.2,
                9498.1,
                9498.3,
                9499.4,
                9500.6,
                9501.6,
                9504.5,
                9506.0,
                9506.0,
                9506.0,
                9506.0,
                9506.0,
                9506.0,
                9506.0,
                9506.0,
                9506.0,
                9506.0,
                9506.0,
                9506.0,
                9506.0,
                9506.0,
                9506.0,
                9506.3,
                9506.7,
                9510.0,
                9520.7,
                9524.0,
                9537.2,
                9556.3,
                9577.1,
                9582.6,
                9587.4,
                9589.9,
                9611.3,
                9614.8,
                9633.7,
                9653.9,
                9675.3,
                9696.5,
                9710.4,
                9732.3,
                9755.1,
                9775.1,
                9780.3,
                9782.9,
                9804.1,
                9810.0,
                9832.8,
                9853.6,
                9876.9,
                9898.7,
                9919.8,
                9941.2,
                9963.5,
                9984.0,
                10007.0,
                10028.8,
                10050.8,
                10057.3,
                10078.7,
                10099.5,
                10105.7,
                10127.1,
                10149.7,
                10170.0,
                10191.1,
                10213.6,
                10233.4,
                10255.4,
                10277.2,
                10297.4,
            ],
            "series_type": "distance",
            "original_size": 638,
            "resolution": "high",
        },
        "time": {
            "data": [
                59,
                62,
                64,
                66,
                70,
                77,
                83,
                89,
                94,
                95,
                99,
                105,
                108,
                114,
                120,
                123,
                128,
                133,
                137,
                143,
                149,
                154,
                159,
                164,
                168,
                174,
                180,
                185,
                187,
                192,
                200,
                206,
                207,
                210,
                213,
                220,
                222,
                224,
                230,
                234,
                237,
                238,
                241,
                243,
                250,
                255,
                260,
                264,
                269,
                272,
                274,
                280,
                285,
                291,
                297,
                299,
                305,
                306,
                310,
                313,
                317,
                318,
                323,
                328,
                334,
                340,
                343,
                349,
                355,
                361,
                367,
                370,
                376,
                380,
                383,
                384,
                385,
                386,
                391,
                395,
                401,
                407,
                409,
                415,
                422,
                428,
                434,
                439,
                445,
                447,
                452,
                457,
                461,
                466,
                471,
                477,
                478,
                483,
                487,
                492,
                495,
                502,
                508,
                509,
                514,
                515,
                519,
                520,
                525,
                530,
                533,
                539,
                546,
                555,
                556,
                559,
                562,
                567,
                573,
                579,
                581,
                587,
                593,
                596,
                601,
                602,
                603,
                604,
                609,
                615,
                620,
                624,
                630,
                636,
                642,
                648,
                653,
                659,
                663,
                669,
                675,
                681,
                682,
                683,
                688,
                690,
                694,
                698,
                704,
                710,
                717,
                723,
                729,
                730,
                731,
                736,
                738,
                743,
                748,
                752,
                757,
                762,
                767,
                773,
                777,
                778,
                784,
                790,
                795,
                801,
                807,
                813,
                819,
                825,
                831,
                837,
                843,
                849,
                853,
                859,
                863,
                2643,
                2644,
                2645,
                2650,
                2651,
                2657,
                2659,
                2660,
                2665,
                2670,
                2671,
                2672,
                2673,
                2677,
                2678,
                2680,
                2681,
                2686,
                2691,
                2696,
                2701,
                2702,
                2704,
                2709,
                2710,
                2711,
                2712,
                2713,
                2715,
                2718,
                2722,
                2726,
                2729,
                2733,
                2738,
                2740,
                2742,
                2744,
                2745,
                2746,
                2747,
                2750,
                2753,
                2755,
                2757,
                2760,
                2761,
                2766,
                2768,
                2769,
                2774,
                2779,
                2784,
                2787,
                2792,
                2795,
                2800,
                2806,
                2811,
                2816,
                2821,
                2826,
                2831,
                2836,
                2841,
                2846,
                2851,
                2856,
                2861,
                2865,
                2866,
                2871,
                2872,
                2873,
                2878,
                2880,
                2882,
                2888,
                2894,
                2901,
                2908,
                2915,
                2922,
                2929,
                2932,
                2939,
                2946,
                2953,
                2960,
                2967,
                2973,
                2980,
                2986,
                2992,
                2998,
                3002,
                3008,
                3013,
                3014,
                3017,
                3022,
                3027,
                3032,
                3037,
                3041,
                3046,
                3051,
                3056,
                3058,
                3063,
                3065,
                3070,
                3075,
                3079,
                3081,
                3086,
                3091,
                3092,
                3094,
                3099,
                3104,
                3109,
                3114,
                3119,
                3122,
                3127,
                3132,
                3137,
                3143,
                3149,
                3155,
                3160,
                3165,
                3170,
                3175,
                3180,
                3185,
                3190,
                3195,
                3200,
                3205,
                3207,
                3212,
                3217,
                3223,
                3228,
                3231,
                3233,
                3235,
                3237,
                3244,
                3251,
                3259,
                3267,
                3275,
                3282,
                3287,
                3290,
                3291,
                3298,
                3306,
                3313,
                3320,
                3327,
                3334,
                3341,
                3348,
                3351,
                3356,
                3358,
                3362,
                3367,
                3369,
                3374,
                3379,
                3384,
                3389,
                3391,
                3396,
                3401,
                3406,
                3408,
                3413,
                3416,
                3418,
                3423,
                3428,
                3433,
                3438,
                3443,
                3444,
                3449,
                3454,
                3459,
                3464,
                3469,
                3474,
                3479,
                3485,
                3490,
                3495,
                3501,
                3507,
                3513,
                3519,
                3524,
                3529,
                3534,
                3539,
                3544,
                3549,
                3554,
                3559,
                3564,
                3569,
                3575,
                3578,
                3582,
                3584,
                3590,
                3598,
                3602,
                3609,
                3615,
                3621,
                3630,
                3638,
                3646,
                3654,
                3660,
                3665,
                3673,
                3681,
                3689,
                3693,
                3699,
                3703,
                3709,
                3712,
                3713,
                3718,
                3720,
                3725,
                3730,
                3734,
                3737,
                3739,
                3741,
                3743,
                3745,
                3747,
                3751,
                3755,
                3760,
                3765,
                3770,
                3775,
                3780,
                3784,
                3786,
                3788,
                3793,
                3798,
                3805,
                3808,
                4781,
                4782,
                4785,
                4788,
                4793,
                4795,
                4796,
                4800,
                4805,
                4812,
                4816,
                4823,
                4830,
                4831,
                4833,
                4837,
                4844,
                4851,
                4858,
                4865,
                4870,
                4876,
                4883,
                4886,
                4892,
                4895,
                4902,
                4905,
                4912,
                4918,
                4924,
                4930,
                4937,
                4944,
                4951,
                4952,
                4959,
                4966,
                4972,
                4980,
                4987,
                4993,
                5000,
                5007,
                5014,
                5021,
                5027,
                5033,
                5040,
                5045,
                5046,
                5050,
                5057,
                5064,
                5071,
                5078,
                5083,
                5086,
                5092,
                5097,
                5104,
                5111,
                5115,
                5119,
                5124,
                5130,
                5133,
                5140,
                5147,
                5154,
                5155,
                5160,
                5166,
                5172,
                5179,
                5180,
                5187,
                5190,
                5197,
                5199,
                5207,
                5209,
                5215,
                5222,
                5223,
                5224,
                5231,
                5238,
                5245,
                5251,
                5254,
                5260,
                5266,
                5273,
                5280,
                5287,
                5294,
                5301,
                5308,
                5313,
                5320,
                5327,
                5332,
                5335,
                5351,
                5358,
                5361,
                5364,
                5368,
                5372,
                5380,
                5388,
                5389,
                5391,
                5399,
                5407,
                5410,
                5417,
                5424,
                5432,
                5439,
                5445,
                5452,
                5453,
                5462,
                5469,
                5475,
                5481,
                5487,
                5489,
                5497,
                5506,
                5514,
                5517,
                5524,
                5526,
                5529,
                5537,
                5548,
                5568,
                5573,
                5595,
                5628,
                5729,
                5730,
                5732,
                5737,
                5738,
                5742,
                5748,
                5755,
                5757,
                5759,
                5760,
                5767,
                5768,
                5774,
                5781,
                5789,
                5797,
                5802,
                5810,
                5818,
                5825,
                5827,
                5828,
                5835,
                5837,
                5846,
                5853,
                5862,
                5869,
                5877,
                5884,
                5891,
                5898,
                5906,
                5913,
                5920,
                5922,
                5929,
                5936,
                5938,
                5944,
                5951,
                5958,
                5965,
                5973,
                5980,
                5987,
                5994,
                6001,
            ],
            "series_type": "distance",
            "original_size": 638,
            "resolution": "high",
        },
    }


def test_get_first_point(activity_good: dict):
    expected = (60.03, 30.3, 1636436728.0, 0)
    assert get_track_start_point(activity_good) == expected


def test_get_first_point_no_date(activity_bad: dict):
    expected = (60.03, 30.3, 0, 0)
    assert get_track_start_point(activity_bad) == expected


def test_build_track(strava_streams: dict):
    start_timestamp: float = 1234567890.0
    expected = np.array(
        [
            [
                60.025713,
                30.29734,
                start_timestamp + 59,
                200.7,
            ],
            [
                60.025625,
                30.297406,
                start_timestamp + 62,
                210.9,
            ],
            [
                60.025575,
                30.297454,
                start_timestamp + 64,
                216.7,
            ],
            [
                60.02552,
                30.297452,
                start_timestamp + 66,
                222.9,
            ],
            [
                60.025453,
                30.297434,
                start_timestamp + 70,
                230.6,
            ],
        ]
    )

    track: ArrayLike = build_track(start_timestamp, 0, strava_streams)
    assert np.array_equal(track[:5], expected)
